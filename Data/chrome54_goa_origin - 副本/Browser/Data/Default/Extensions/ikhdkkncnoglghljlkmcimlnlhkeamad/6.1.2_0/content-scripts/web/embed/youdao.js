!function(){var j=[],h="http://fanyi.youdao.com/web2",e=new Image;if(e.src="http://fanyi.youdao.com/web2/rl.do?action=init&relatedURL="+encodeURIComponent(document.location.href)+"&ts="+(new Date).getTime(),j[0]=e,window.OUTFOX_JavascriptTranslatoR){var k="http://fanyi.youdao.com",a="/web2/conn.html",l=h+"/index.do",g=k+"/jtr",c=h+"/rl.do",f=h+"/styles/all-packed.css";J.loadCSS(document,f),window.OUTFOX_JavascriptTranslatoR=new J.TR.UI(document.body,{domain:k,update:!1,updateTipMsg:"增加关闭按钮",updateDate:"2011-3-15",cssURL:f,tipsURL:l,transURL:g,logURL:c,connFilePath:a,reqSize:20})}else{if(this.JSON&&-1!==this.JSON.stringify.toString().indexOf("[native code]")?this.JSONDAO=this.JSON:this.JSONDAO={},function(){function f(e){return 10>e?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,i,a,s,r,o=gap,l=t[e];switch(l&&"object"==typeof l&&"function"==typeof l.toJSON&&(l=l.toJSON(e)),"function"==typeof rep&&(l=rep.call(t,e,l)),typeof l){case"string":return quote(l);case"number":return isFinite(l)?String(l):"null";case"boolean":case"null":return String(l);case"object":if(!l)return"null";if(gap+=indent,r=[],"[object Array]"===Object.prototype.toString.apply(l)){for(s=l.length,n=0;s>n;n+=1)r[n]=str(n,l)||"null";return a=0===r.length?"[]":gap?"[\n"+gap+r.join(",\n"+gap)+"\n"+o+"]":"["+r.join(",")+"]",gap=o,a}if(rep&&"object"==typeof rep)for(s=rep.length,n=0;s>n;n+=1)i=rep[n],"string"==typeof i&&(a=str(i,l),a&&r.push(quote(i)+(gap?": ":":")+a));else for(i in l)Object.hasOwnProperty.call(l,i)&&(a=str(i,l),a&&r.push(quote(i)+(gap?": ":":")+a));return a=0===r.length?"{}":gap?"{\n"+gap+r.join(",\n"+gap)+"\n"+o+"}":"{"+r.join(",")+"}",gap=o,a}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSONDAO.stringify&&(JSONDAO.stringify=function(e,t,n){var i;if(gap="",indent="","number"==typeof n)for(i=0;n>i;i+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSONDAO.stringify");return str("",{"":e})}),"function"!=typeof JSONDAO.parse&&(JSONDAO.parse=function(text,reviver){function walk(e,t){var n,i,a=e[t];if(a&&"object"==typeof a)for(n in a)Object.hasOwnProperty.call(a,n)&&(i=walk(a,n),void 0!==i?a[n]=i:delete a[n]);return reviver.call(e,t,a)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSONDAO.parse")})}(),function(){var e={browser:function(){var e,t={},n=navigator.userAgent.toLowerCase();return(e=n.match(/msie ([\d.]+)/))?t.msie=e[1]:(e=n.match(/firefox\/([\d.]+)/))?t.firefox=e[1]:(e=n.match(/chrome\/([\d.]+)/))?t.chrome=e[1]:(e=n.match(/opera.([\d.]+)/))?t.opera=e[1]:(e=n.match(/version\/([\d.]+).*safari/))?t.safari=e[1]:0,t}(),isDOM:function(e){return Boolean(e&&1===e.nodeType)},isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)},each:function(t,n,i){if(void 0!==t&&null!==t){if(void 0===t.length||e.isFunction(t)){for(var a in t)if(t.hasOwnProperty(a)&&n.call(i||t[a],a,t[a])===!1)break}else for(var s=0;s<t.length&&n.call(i||t[s],s,t[s])!==!1;s++);return t}},indexOf:function(t,n){if(t.indexOf)return t.indexOf(n);var i=-1;return e.each(t,function(e){return this===n?(i=e,!1):void 0}),i},bind:function(e,t,n){return n?(e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n,this):void 0},unbind:function(e,t,n){return n?(e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent?e.detachEvent("on"+t,n):e["on"+t]=function(){},this):void 0},param:function(t){if("string"==typeof t)return t;var n=[];return e.each(t,function(t,i){i&&(i=encodeURIComponent(i),e.browser.firefox&&(i=encodeURIComponent(unescape(i))),n.push(encodeURIComponent(t)+"="+i))}),n.join("&")},makeArray:function(e){return Array.prototype.slice.call(e,0)},getDocumentCharset:function(){return e.log("document.characterSet || document.charset:::"+document.characterSet||document.charset),document.characterSet||document.charset},log:function(){if(window.console&&window.console.log){var t=e.makeArray(arguments);t.unshift("[J]");try{window.console.log.apply(window.console,t)}catch(n){3===arguments.length?window.console.log(arguments[0],arguments[1],arguments[2]):2===arguments.length?window.console.log(arguments[0],arguments[1]):window.console.log(arguments[0])}}},css:function(){var t=function(e,t){var n="";if("float"==t&&(t=document.defaultView?"float":"styleFloat"),e.style[t])n=e.style[t];else if(e.currentStyle)n=e.currentStyle[t];else if(document.defaultView&&document.defaultView.getComputedStyle){t=t.replace(/([A-Z])/g,"-$1").toLowerCase();var i=document.defaultView.getComputedStyle(e,"");n=i&&i.getPropertyValue(t)}else n=null;if("auto"!=n&&-1===n.indexOf("%")||"width"!==t.toLowerCase()&&"height"!==t.toLowerCase()||"none"==e.style.display||-1===n.indexOf("%")||(n=e["offset"+t.charAt(0).toUpperCase()+t.substring(1).toLowerCase()]+"px"),"opacity"==t)try{n=e.filters["DXImageTransform.Microsoft.Alpha"].opacity,n/=100}catch(a){try{n=e.filters("alpha").opacity}catch(s){}}return n};return function(n,i){return"string"==typeof i?t(n,i):void e.each(i,function(e,t){n.style[e]=t})}}(),getPageSize:function(){var e,t;window.innerHeight&&window.scrollMaxY?(e=document.body.scrollWidth,t=window.innerHeight+window.scrollMaxY):(e=Math.max(document.body.scrollWidth,document.body.offsetWidth),t=Math.max(document.body.scrollHeight,document.body.offsetHeight));var n,i;n=document.documentElement.clientWidth||document.body.clientWidth,i=document.documentElement.clientHeight||document.body.clientHeight;var a=Math.max(t,i),s=Math.max(e,n);return{page:{width:s,height:a},window:{width:n,height:i}}},findPos:function(t){var n={x:0,y:0};if(document.documentElement.getBoundingClientRect())n.x=t.getBoundingClientRect().left+e.scroll().left,n.y=t.getBoundingClientRect().top+e.scroll().top;else for(;t;)n.x+=t.offsetLeft,n.y+=t.offsetTop,t=t.offsetParent;return n},textPos:function(t,n){var i=t||window.event,a={},s={},r=n.h,o=n.v||"bottom";if(window.getSelection?a=window.getSelection().getRangeAt(0):document.selection&&(a=document.selection.createRange()),r?s.x=l[r]+e.scroll().left:i.pageX||i.pageY?s.x=i.pageX:(i.clientX||i.clientY)&&(s.x=i.clientX+e.scroll().left),a.getBoundingClientRect){var l=a.getBoundingClientRect();s.y=l[o]+e.scroll().top}else i.pageX||i.pageY?s.y=i.pageY:(i.clientX||i.clientY)&&(s.y=i.clientY+e.scroll().top);return s},scroll:function(){return{left:document.documentElement.scrollLeft+document.body.scrollLeft,top:document.documentElement.scrollTop+document.body.scrollTop}},walkTheDOM:function(e,t,n){if((!n||n(e))&&(t(e),"NOSCRIPT"!==e.tagName&&"IFRAME"!==e.tagName&&"FRAME"!==e.tagName))for(e=e.firstChild;e;)arguments.callee(e,t,n),e=e.nextSibling},getTextNodes:function(t,n){var i=[];return e.walkTheDOM(t,function(t){3===t.nodeType&&e.trim(t.nodeValue)&&i.push(t)},n),i},getElementsByClassName:function(t,n){if(t.getElementsByClassName)return t.getElementsByClassName(n);var i=[];return e.walkTheDOM(t,function(t){e.hasClass(t,n)&&i.push(t)}),i},query:function(t,n){var i=new RegExp("(?:(?:\\.([^()]+))?)(?:(?:#([^()]+))?)"),a=i.exec(t),s=n||document;if(!a)return null;if(a[1]){var r=a[1];if(s.getElementsByClassName)return s.getElementsByClassName(r);var o=[];return e.walkTheDOM(s,function(t){e.hasClass(t,r)&&o.push(t)}),o}return a[2]?s.getElementById(a[2]):void 0},trim:function(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")},formatTemplate:function(e,t){var n=document.createElement("div");for(var i in t)t.hasOwnProperty(i)&&(e=e.replace(new RegExp("{"+i+"}","g"),t[i]));n.innerHTML=e;var a=n.firstChild;return n.removeChild(a),a},hasClass:function(t,n){if(e.isDOM(t)){if(t.className===n)return!0;for(var i=t.className.split(" "),a=0,s=i.length;s>a;a++)if(n===i[a])return!0}return!1},loadCSS:function(t,n){var i=function(e){if(t&&t.createElement){var n=(Date.parse(new Date),t.createElement("link")),i=-1===e.indexOf("?")?e+"?572877":e+"&572877";n.setAttribute("rel","stylesheet"),n.setAttribute("href",i),n.setAttribute("type","text/css");var a=t.getElementsByTagName("head")[0]||t.body;a.appendChild(n)}};e.isArray(n)?e.each(n,function(e,t){i(t)}):"string"==typeof n&&i(n)},addClass:function(t,n){if(e.isDOM(t)){for(var i=t.className.split(" "),a=0,s=i.length;s>a;a++)if(n===i[a])return;i[a]=n,t.className=i.join(" ")}},removeClass:function(t,n){if(e.isDOM(t)){for(var i=t.className.split(" "),a=0,s=i.length,r=[];s>a;a++)n!==i[a]&&r.push(i[a]);t.className=r.join(" ")}},toggleClass:function(t,n){if(e.isDOM(t)){for(var i=t.className.split(" "),a=0,s=i.length,r=[],o="add";s>a;a++)n===i[a]?o="remove":r.push(i[a]);"add"===o?i[a]=n:i=r,t.className=i.join(" ")}},guid:function(){var e=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return function(){return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}}(),protoExtend:function(t,n){var i=e.isFunction(n)?n:function(){};return i.prototype=t,new i},stopPropagation:function(e){var t=e||window.event;return t.stopPropagation&&t.stopPropagation(),t.cancelBubble=!0,t},storage:function(e,t){var n=function(e,t){var n=window.localStorage;return void 0===t?n.getItem(e):void 0!==e&&void 0!==t?(n.setItem(e,t),t):void 0},i=function(e,t){var n=document.documentElement;return n.addBehavior("#default#userData"),void 0===t?(n.load("fanyiweb2"),n.getAttribute(e)):void 0!==e&&void 0!==t?(n.setAttribute(e,t),n.save("fanyiweb2"),t):void 0};return window.localStorage?n(e,t):document.documentElement.addBehavior?i(e,t):void 0},cookie:function(e,t){function n(e,t){var n=30,i=new Date;i.setTime(i.getTime()+24*n*60*60*1e3),document.cookie=e+"="+t+";expire*="+i.toGMTString()}function i(e){var t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]*)(;|$)"));return null!=t?decodeURIComponent(t[2]):null}return t?void n(e,t):i(e)},parseData:function(){var t={json:function(t){try{return t=JSONDAO.parse(t)}catch(n){e.log("[Error]","Invalid JSON data:",t)}},xml:function(e){if(window.DOMParser)return(new DOMParser).parseFromString(e,"text/xml");var t=new ActiveXObject("Microsoft.XMLDOM");return t.async="false",t.loadXML(e),t}};return function(n,i){return void 0===n?i:e.isFunction(n)?n(i):n&&!t[n]?(e.log("[Error]","Function parseData() dosen't support this type:",n),i):t[n](i)}}(),once:function(t){return function(){e.isFunction(t)&&t.apply(this,arguments),t=function(){}}}};window.J=e}(),function(e){var t=function(e,n,i){return new t.prototype.init(e,n,i)};t.prototype={init:function(e,t,n){var i=this,a=[],s=function(e){for(i.ajax=e;a.length>0;)e(a.pop())};return window.postMessage?this.createMessageChannel(e,t,n,s):this.createJTRAssist(e,s),this.ajax=function(e){return a.push(e),this},this},createMessageChannel:function(t,n,i,a){var s=this,r=function(){if(e.isDOM(e.query("#"+t)))throw new Error("Existed CDA iFrame element");if(n&&i){var a=document.createElement("iframe");return a.setAttribute("id",t),a.className="OUTFOX_JTR_CONN",a.style.display="none",a.setAttribute("src",n+i),document.body.appendChild(a),a.contentWindow}throw new Error("Empty domain is not allowed")}(),o=function(){var t=[],i=0,o={transferStationReady:function(){a(function(a){return a.data=e.param(a.data),a.index=i++,t[a.index]={dataType:a.dataType,callback:a.callback},delete a.callback,r.postMessage(JSONDAO.stringify(a),n),s})},dataBack:function(n){if(n&&t[n.index]){var i=t[n.index];e.isFunction(i.callback)&&i.callback(e.parseData(i.dataType,n.response)),delete t[n.index]}}};return function(e){if(e.origin===n){var t=JSONDAO.parse(e.data);o[t.handler](JSONDAO.parse(e.data))}}}();e.bind(window,"message",function(e){o.call(s,e)})},createJTRAssist:function(t,n){var i=this,a="http://fanyi.youdao.com/web2/JTRAssist.swf?"+ +new Date,s=function(){if(!e.query("#"+t)){var n=document.createElement("div");"6.0"===e.browser.msie||"7.0"===e.browser.msie?n.innerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="1" height="1" id="'+t+'"><param name="allowScriptAccess" value="always" /><param name="movie" value="'+a+'" /></object>':n.innerHTML='<object height="1" width="1" id="'+t+'" data="'+a+'"><param name="allowScriptAccess" value="always"></object>',document.body.appendChild(n)}},r="outfox_jtr_fproxy_callback_",o=0,l=function(n){var a=r+o++;window[a]=function(t){n.callback.call(i,e.parseData(n.dataType,decodeURI(t)))},e.query("#"+t).load(n.url,n.data,n.type||"POST",'window["'+a+'"]')},d=function(n){var i=n.data.key,a=n.data.value;void 0===a?e.isFunction(n.callback)&&n.callback(e.parseData(n.dataType,e.query("#"+t).getItem(i))):e.query("#"+t).setItem(i,a)};s(),window.JTRAssistIsReady=function(){n(function(t){switch(t.handler){case"translate":t.data=e.param(t.data),l(t);break;case"localStorage":d(t);break;default:throw new Error("Unsupported request type :"+t.handler)}return i})}}},t.prototype.init.prototype=t.prototype,e.CDA=t}(J),function(e){TR=function(t,n,i,a){this._manager=a,this._reqSize=n.reqSize,this._onStatusChange=n.onStatusChange||function(){},this._url=n.url,this.conn=i,this._context=t,this._request=function(e,t,n){i.ajax({url:e,handler:"translate",type:"POST",data:t,callback:n,dataType:"json"})};var s=new e.Page(t),r=[],o=s.getMainArticle();o&&(r=e.getTextNodes(o.elem,TR.isInclude)),this.mainNodeLength=r.length||null,this._nodeIndex=[],r=r.concat(e.getTextNodes(t,function(e){return e!==(o&&o.elem)&&TR.isInclude(e)})),e.each(r,function(e,t){this._nodeIndex.push(this._manager.addNode(t))},this),this.workingThread=0,this.guid=n.guid||e.guid()},TR.prototype={doTrans:function(){for(var t=++this.workingThread,n={ue:e.getDocumentCharset()||null,data:null,relatedUrl:document.location.href,guid:this.guid,mainLength:this.mainNodeLength,requestId:e.guid()},i=[],a=0,s=0;s<this._nodeIndex.length;s++)if(this._manager.transResults[s])t===this.workingThread&&this._manager.replaceTrans(s);else{var r=null;r=i[parseInt(a/this._reqSize,10)]?i[parseInt(a++/this._reqSize,10)]:i[parseInt(a++/this._reqSize,10)]={};var o=null;try{o=this._manager.nodes[s].parentNode&&this._manager.nodes[s].parentNode.tagName||null}catch(l){}r[s]={src:this._manager.originals[s],tag:o}}if(0===i.length)return void this._onStatusChange({id:t,action:"TRANS",level:"0",status:"finish"});var d=this,c=function(e){d._onStatusChange({id:t,action:"TRANS",level:"0",status:"busy",data:[e,i.length]}),n.data=JSONDAO.stringify(i[e]),d._request(d._url.textTrans,n,function(n){d._updateTrans(n,t),++e<i.length?c(e):d._onStatusChange({id:t,action:"TRANS",level:"0",status:"finish"})})};c(0)},revertTrans:function(){for(var e=++this.workingThread,t=0;t<this._nodeIndex.length;t++)e===this.workingThread&&this._manager.revertTrans(this._nodeIndex[t])},_updateTrans:function(t,n){return t?40===t.errorCode&&30===t.errorCode?void e.log("Get Error Code:",t.errorCode):void e.each(t.data,function(e,t){this._manager.transResults[e]=t.tst,n===this.workingThread&&this._manager.replaceTrans(e)},this):void 0},doTips:function(t){for(var n=++this.workingThread,i={type:"X",ue:e.getDocumentCharset()||null,data:null,relatedUrl:document.location.href,mainLength:this.mainNodeLength,guid:this.guid},a=[],s=0,r=0;r<this._nodeIndex.length;r++)if(this._manager.tipsResults[r])n===this.workingThread&&this._manager.replaceTips(r,t);else{var o=null;o=a[parseInt(s/this._reqSize,10)]?a[parseInt(s++/this._reqSize,10)]:a[parseInt(s++/this._reqSize,10)]={};var l=null;try{l=this._manager.nodes[r].parentNode&&this._manager.nodes[r].parentNode.tagName||null}catch(d){}o[r]={src:this._manager.originals[r],tag:l}}if(0===a.length)return void this._onStatusChange({id:n,action:"TIPS",level:t,status:"finish"});var c=this,u=function(s){e.log("Send:",a[s]),c._onStatusChange({id:n,action:"TIPS",level:t,data:[s,a.length],status:"busy"}),i.data=JSONDAO.stringify(a[s]),c._request(c._url.tips,i,function(e){c._updateTips(e,n,t),++s<a.length?u(s):c._onStatusChange({id:n,action:"TIPS",level:t,status:"finish"})})};u(0)},revertTips:function(){for(var e=++this.workingThread,t=0;t<this._nodeIndex.length;t++)e===this.workingThread&&this._manager.revertTips(this._nodeIndex[t])},_updateTips:function(t,n,i){if(t){if(40===t.errorCode&&30===t.errorCode)return void e.log("Get Error Code:",t.errorCode);var a=function(e,t){return e.start>t.start};e.each(t.data,function(e,t){t.length>0?(this._bubbleSort(t,a),this._manager.tipsResults[e]=t,n===this.workingThread&&this._manager.replaceTips(e,i)):this._manager.tipsResults[e]=[]},this)}},_bubbleSort:function(e,t){for(var n=e.length-2;n>=0;n--)for(var i=0;n>=i;i++)if(t(e[i+1],e[i])){var a=e[i];e[i]=e[i+1],e[i+1]=a}return e}},TR.isInclude=function(e){return!("SCRIPT"===e.tagName||"STYLE"===e.tagName||"PRE"===e.tagName||e.className&&-1!==e.className.indexOf("OUTFOX_JTR_"))},e.TR=TR}(J),!J||!J.bind)throw new Error("swipe extension need J.bind support");!function(e){var t="http://fanyi.youdao.com",n=t+"/fsearch",a=t+"/translate",s=function(e){return'<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=7,0,0,0" width="15px" height="15px" align="absmiddle" id="speach_flash"><param name="allowScriptAccess" value="sameDomain" /><param name="movie" value="http://cidian.youdao.com/chromeplus/voice.swf" /><param name="loop" value="false" /><param name="menu" value="false" /><param name="quality" value="high" /><param name="wmode"  value="transparent"><param name="FlashVars" value="audio='+e+'"><embed wmode="transparent" play="false" src="http://cidian.youdao.com/chromeplus/voice.swf" loop="false" menu="false" quality="high" bgcolor="#ffffff" width="15" height="15" align="absmiddle" allowScriptAccess="sameDomain" FlashVars="audio='+e+'" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" /></object>'},r=function(e){return e.split&&e.split(" ").length||0},o={isJapanese:function(e){return!Boolean(/[^\u0800-\u4e00]/.test(e))},isContainJapanese:function(e){for(var t=0,n=0;n<e.length;n++)this.isJapanese(e.charAt(n))&&t++;return t>2},isKoera:function(e){for(i=0;i<e.length;i++)if(e.charCodeAt(i)>12592&&e.charCodeAt(i)<12687||e.charCodeAt(i)>=44032&&e.charCodeAt(i)<=55203)return!0;return!1},isContainKoera:function(e){for(var t=0,n=0;n<e.length;n++)this.isKoera(e.charAt(n))&&t++;return t>0},isChinese:function(e){return!Boolean(/[^\u4e00-\u9fa5]/.test(e))},isContainChinese:function(e){for(var t=0,n=0;n<e.length;n++)this.isChinese(e.charAt(n))&&t++;return t>5}},l=function(e,t){return new l.fn.init(e,t)};l.fn=l.prototype={init:function(t,n){var i=this;this.wrapper=l.createFrameWrapper(),this.conn=l.initConnection(n),this.context=t,e.bind(document.body,"click",function(e){e||window.event;i.wrapper.style.display="none",i.wrapper.style.position="absolute",i.wrapper.innerHTML=""})},enableSwipe:function(){if(!this._swipeListener){var t=this;this._swipeListener=function(e){t._onSwipe.call(t,e)},e.bind(this.context,"mouseup",this._swipeListener)}},disableSwipe:function(){this._swipeListener&&(e.unbind(this.context,"mouseup",this._swipeListener),delete this._swipeListener)},_onSwipe:function(t){var n="",i="";window.getSelection?n=window.getSelection():document.selection&&(n=document.selection.createRange()),n.toString?i=n.toString():n.text&&(i=n.text.toString());var a=e.textPos(t,{});i=e.trim(i),l.validateSwipeWord(i)&&(this.swipeWord(i,a.x,a.y),this.onSwipeCallback&&this.onSwipeCallback(i))},swipeWord:function(e,t,n,i,a){var s=this,d=null;this.wrapper.innerHTML="",d=!o.isContainChinese(e)&&r(e)>=3||o.isContainChinese(e)||o.isContainJapanese(e)&&e.length>4?"translate":"dict",this.conn.request({action:d,word:e},function(e){s.wrapper.innerHTML="",s._onResponse.call(s,e),l.initWrapper(s.wrapper,t,n,i,a)})},_onResponse:function(e){var t=e.firstChild,n=null;if(t){switch(t.baseName&&"xml"==t.baseName&&(t=t.nextSibling),t.tagName){case"response":n=l.processXmlTransData(e);break;case"yodaodict":n=l.processXmlDictData(e);break;default:throw new Error("Incorrect xml data")}n&&(this.wrapper.appendChild(n),this.wrapper.style.display="block")}}},l.createFrameWrapper=function(){var t=document.createElement("div");return t.id="yddWrapper",e.bind(t,"click",function(t){e.stopPropagation(t)}),e.bind(t,"mouseup",function(t){e.stopPropagation(t)}),document.body.appendChild(t),t},l.validateSwipeWord=function(e){return!(""===e||e.length>2e3)},l.initConnection=function(i){var s=null,r=function(e){var t=null,i=null;return"dict"==e.action?(i={client:"JTRHelper",keyfrom:"JTRHelper.bookmark",q:e.word,pos:-1,doctype:"xml",xmlVersion:"3.2",dogVersion:"1.0",vendor:"jtr",le:"eng"},t=n):(i={client:"JTRHelper",keyfrom:"JTRHelper.bookmark",i:e.word,doctype:"xml",xmlVersion:"1.1",dogVersion:"1.0"},t=a),[t,i]};if(window.chrome&&window.chrome.extension&&window.chrome.extension.sendRequest)return s={request:function(e,t){window.chrome.extension.sendRequest(e,function(e){e&&t((new DOMParser).parseFromString(e,"text/xml"))})}};if(i)return s={request:function(e,t){var n=r(e);i.ajax({url:n[0],handler:"translate",data:n[1],callback:t,dataType:"xml",type:"POST"})}};if(e.CDA){var o=null;try{o=e.CDA("_OUTFOX_JTR_SWIPE_CONN",t,CONN_FILE_PATH)}catch(l){throw new Error("Unable to get cross-domain ajax file.")}return s={request:function(e,t){var n=r(e);o.ajax({url:n[0],handler:"translate",data:n[1],callback:t,dataType:"xml",type:"POST"})}}}throw new Error("Unable to initialize cross-domain connection port.")},l.initWrapper=function(t,n,i,a,s){var r=0,o=0,l=50,d=e.scroll().top,c=e.scroll().left,u=t.clientHeight,h=t.clientWidth,p=(e.getPageSize().window.height,e.getPageSize().window.width);a=a||0,s=s||0,o=i-u>=d+l?i-u:i+s,r=p+c>=n+h?n+a:p+c-h;var f=!("static"===e.css(document.body,"position")),m=e.css(document.body,"marginLeft"),g=e.css(document.body,"marginRight");if("auto"===m&&"auto"===g){var v=e.getPageSize().page.width,T=parseInt(e.css(document.body,"width"));m=v>T?(v-T)/2:0}m=f?parseInt(m):0;var y=f?parseInt(e.css(document.body,"marginTop")):0;e.css(t,{position:"absolute",left:r-m+"px",top:o-y+"px"})},l.processXmlTransData=function(t){var n=(t.getElementsByTagName("input")[0].childNodes[1]||t.getElementsByTagName("input")[0].childNodes[0]).nodeValue,i=(t.getElementsByTagName("translation")[0].childNodes[1]||t.getElementsByTagName("translation")[0].childNodes[0]).nodeValue,a=(t.getElementsByTagName("response")[0].getAttribute("errorCode")-0,e.trim(i)),s=e.trim(n);if((o.isContainChinese(s)||o.isContainJapanese(s)||o.isContainKoera(s))&&s.length>15?s=s.substring(0,8)+" ...":s.length>25&&(s=s.substring(0,15)+" ..."),s==a)return null;var r="http://fanyi.youdao.com/translate?i="+encodeURIComponent(n)+"&keyfrom=chrome",d='<div class="ydd-container">                          <div class="ydd-top-wrapper">                            <div class="ydd-top">                            </div>                          </div>                          <div class="ydd-body-wrapper">                            <div class="ydd-lb"></div>                            <div class="ydd-rb"></div>                            <div class="ydd-body">                              <div class="ydd-titile">                                <span>{input}</span>                                <span><a href="{searchURL}" target="_blank">详细&rsaquo;&rsaquo;</a></span>                              </div>                              <div class="ydd-middle">                                <div class="ydd-trans-wrapper ydd-simple-trans">                                  <div class="ydd-trans-container">{trans}</div>                                </div>                              </div>                            </div>                          </div>                          <div class="ydd-bottom-wrapper"><div class="ydd-bottom"></div></div>                          <div class="ydd-bg-top"></div></div>                        </div>';return e.formatTemplate(d,{searchURL:r,input:l.escapeHTML(s),trans:l.escapeHTML(i)})},l.processXmlDictData=function(t){var n=null,i=null,a=[],r=[],l="",d="",c="",u="",h=0,p=function(e){try{return t.getElementsByTagName(e)[0].firstChild.nodeValue}catch(n){return""}};if(l=p("return-phrase"),d=p("dictcn-speach"),c=p("lang"),u=p("phonetic-symbol"),(i=t.getElementsByTagName("translation"))&&i.length>0)for(h=0;h<i.length;h++)a.push(i[h].getElementsByTagName("content")[0].firstChild.nodeValue);if((n=t.getElementsByTagName("web-translation"))&&n.length>0)for(h=0;h<n.length-1;h++)r.push({key:n[h].getElementsByTagName("key")[0].firstChild.nodeValue,value:n[h].getElementsByTagName("trans")[0].getElementsByTagName("value")[0].firstChild.nodeValue});var f="http://dict.youdao.com/search?q="+encodeURIComponent(l)+"&keyfrom=chrome.extension"+c,m=l,g="",v="",T="",y=null,b="http://www.youdao.com/search?q={title}&keyfrom=fanyi.jtr",w="";for(w='<div class="ydd-container">                      <div class="ydd-top-wrapper">                        <div class="ydd-top"></div>                      </div>                      <div class="ydd-body-wrapper">                        <div class="ydd-lb"></div>                        <div class="ydd-rb"></div>                        <div class="ydd-body">                          <div class="ydd-titile">                            <span class="ydd-key-title">{title}</span>                            <span class="ydd-phonetic">{phonetic}</span> {speechHTML} <span class="ydd-detail"><a href="{searchURL}" target="_blank">详细&rsaquo;&rsaquo;</a></span>                          </div>                          <div class="ydd-middle">                            <div class="ydd-trans-wrapper ydd-base-trans">                              <div class="ydd-tabs"><span class="ydd-tab">基本翻译</span></div>{baseTransHTML}</div>                              <div class="ydd-trans-wrapper ydd-web-trans">                                <div class="ydd-tabs"><span class="ydd-tab">网络释义</span></div>{webTransHTML}</div>                              </div>                            </div>                          </div>                        <div class="ydd-bottom-wrapper">                          <div class="ydd-bottom"><a href="'+b+'" target="_blank" title="使用有道搜索 {title}">搜索&nbsp;{title}</a></div>                        </div>                        <div class="ydd-bg-top"></div>                      </div>                    </div>',(o.isContainChinese(m)||o.isContainJapanese(m)||o.isContainKoera(m))&&m.length>15?m=m.substring(0,10)+"...":m.length>25&&(m=m.substring(0,15)+" ..."),a.length+r.length>0&&d&&(g='<span class="ydd-voice">'+s("http://dict.youdao.com/speech?audio="+d,"test","CLICK","dictcn_speech")+"</span>"),h=0;h<a.length;h++)v+='<div class="ydd-trans-container">'+a[h]+"</div>";for(h=0;h<r.length;h++){var _="http://dict.youdao.com/search?q="+encodeURIComponent(r[h].key)+"&keyfrom=chrome.extension"+c;T+='<div class="ydd-trans-container"><a href="'+_+'" target="_blank">'+r[h].key+":</a> "+r[h].value+"</div>"}y=e.formatTemplate(w,{phonetic:u?"["+u+"]":"",title:m,searchURL:f,speechHTML:g,baseTransHTML:v,webTransHTML:T});var O=e.query(".ydd-middle",y)[0];i=e.query(".ydd-base-trans",O)[0],n=e.query(".ydd-web-trans",O)[0],a.length+r.length===0&&(O.innerHTML='<p class="ydd-no-result">没有英汉互译结果</p>');try{0===a.length?O.removeChild(i):0===r.length&&O.removeChild(n)}catch(S){}return y};var d={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};l.escapeHTML=function(e){return String(e).replace(/[&<>"'\/]/g,function(e){return d[e]})},l.fn.init.prototype=l.fn,e.Swipe=l}(J),function(e){var t=function(t,n,i){var a=this;if(!e.isDOM(t))throw Error("Invalid slider container element");if(this.container=t,!e.isDOM(n))throw Error("Invalid slider controller block element");this.controller=n;for(var s=this.container;s;s=s.parentNode)if(9===s.nodeType){this.document=s;break}if(!s)throw Error("Can't find parent Document element of container, container dom node should insert to document first");if(e.isDOM(i.bar)?this.bar=i.bar:this.bar=null,this.range=Number(i.max-i.min),!(this.range&&this.range>0))throw Error("range must greater than 0");e.isFunction(i.callback)&&(this.callback=function(e){i.callback.call(a,e)}),this.borderFix=Number(i.borderFix)||0,this.mousemove=function(e){a._mousemove(e)},this.mouseup=function(e){a._mouseup(e)},this.mousedown=function(e){a._mousedown(e)}};t.prototype={enable:function(){e.bind(this.container,"mousedown",this.mousedown)},disable:function(){e.unbind(this.container,"mousedown",this.mousedown)},to:function(e,t){var n=this,i=null;tempFunc=function(){if(!n.container.offsetHeight||!n.container.clientWidth)return void(i=setTimeout(tempFunc,200));var t=n.container.clientWidth-n.controller.clientWidth-2*n.borderFix;pos=e/n.range*t,n._valueChange(pos/t*n.range,pos)},tempFunc()},_mousemove:function(e){var t=e||window.event;this._moveHandler(t,!1)},_mouseup:function(t){var n=t||window.event;this._moveHandler(n,!0),e.unbind(this.document,"mouseup",this.mouseup),e.unbind(this.document,"mousemove",this.mousemove),this.container.style.cursor="pointer"},_mousedown:function(t){var n=t||window.event;this._moveHandler(n,!1),e.bind(this.document,"mouseup",this.mouseup),e.bind(this.document,"mousemove",this.mousemove),n.preventDefault&&n.preventDefault(),n.returnValue=!1},_moveHandler:function(t,n){var i=t.clientX-.5*this.controller.clientWidth-e.findPos(this.container).x-this.borderFix,a=this.container.clientWidth-this.controller.clientWidth-2*this.borderFix,s=a/this.range,r=s/2,o=i%s,l=0;0>i?(i=0,o=0):i>a&&(i=a,o=0),l=n&&r>o?i-o:n&&o>s-r?i-o+s:i,this._valueChange(l/a*this.range,l)},_valueChange:function(e,t){this.callback(e),this.controller.style.left=t+this.borderFix+"px",this.bar&&(this.bar.style.width=t+this.controller.clientWidth/2+"px")}},e.Slider=t}(J),function(e){var t=function(){this.nodes=[],this.originals={},this.transResults={},this.tipsResults={}};t.prototype={addNode:function(e,t){var n=0;if(!t)for(;n<this.nodes.length;n++)if(this.nodes[n]===e)return n;return this.nodes.push(e),this.originals[n]=e.nodeValue,n},replaceTrans:function(e){if(this.nodes[e]&&this.transResults[e]){var t=this.nodes[e],n=document.createElement("font"),i=this.transResults[e];try{if(t.nodeValue===i)return!1;if(!t.parentNode)return}catch(a){return}t.nodeValue="",n.className="OUTFOX_JTR_TRANS_NODE",n.id="OUTFOX_JTR_TRANS_NODE-"+e,n.setAttribute("rel",e),n.innerHTML=i;try{t.parentNode.insertBefore(n,t.nextSibling)}catch(s){}}},revertTrans:function(t){if(this.nodes[t]&&this.originals[t]){var n=e.query("#OUTFOX_JTR_TRANS_NODE-"+t);n&&n.parentNode&&n.parentNode.removeChild(n);try{this.nodes[t].nodeValue=this.originals[t]}catch(i){}}},replaceTips:function(t,n){var i=n||-1;this.nodes[t]&&this.tipsResults[t]&&e.each(this.tipsResults[t],function(e,n){if(!(n.level&&n.level<i)){var a=this.nodes[t],s=n.start,r=n.end,o=n.explain;
if(void 0!==typeof a.parentNode){var l=document.createElement("font");l.className="OUTFOX_NANCI_WRAPPER";try{var d=a.nodeValue.substr(0,s),c=a.nodeValue.substr(s,r-s),u=a.nodeValue.substr(r);a.nodeValue=d,l.innerHTML=c,a.parentNode.insertBefore(document.createTextNode(u),a.nextSibling),a.parentNode.insertBefore(l,a.nextSibling);var h=document.createElement("font");h.className="OUTFOX_NANCI_TIPS",h.setAttribute("rel",t),h.innerHTML="("+o+")",l.parentNode.insertBefore(h,l.nextSibling)}catch(p){}}}},this)},revertTips:function(e){if(this.nodes[e]){var t;do try{t=!this.revertTip(this.nodes[e].nextSibling)}catch(n){t=!0}while(!t)}},revertTip:function(t){if(e.hasClass(t,"OUTFOX_NANCI_WRAPPER")&&t.firstChild){var n=t.nextSibling;return e.hasClass(n,"OUTFOX_NANCI_TIPS")&&n.parentNode.removeChild(n),t.nextSibling&&3===t.nextSibling.nodeType&&(t.firstChild.nodeValue+=t.nextSibling.nodeValue,t.parentNode.removeChild(t.nextSibling)),t.previousSibling&&3===t.previousSibling.nodeType&&(t.previousSibling.nodeValue+=t.firstChild.nodeValue,t.parentNode.removeChild(t)),!0}return!1},countTips:function(t){var n=0;return e.each(this.tipsResults,function(e,i){for(var a=0;a<i.length;a++)i[a].level>=t&&n++},this),n}},e.NodeManager=t}(J),function(e){var t=function(){this.map={},this.dataMap={}};t.prototype={getId:function(t){var n=null;return e.each(this.map,function(e,i){return i===t?(n=e,!1):void 0}),null===n&&(n=e.guid(),this.map[n]=t),n},data:function(e,t,n){var i=this.getId(e);if(3===arguments.length)return this.dataMap[i]||(this.dataMap[i]={}),this.dataMap[i][t]=n,n;var a=null;try{a=this.dataMap[i][t]}catch(s){a=void 0}return a}},e.Cache=t}(J),function(e){var t=function(t){this.contentDocument=t,this.cache=new e.Cache};t.prototype={IGNORE_TAGS:["HTML","HEAD","META","TITLE","SCRIPT","STYLE","LINK","IMG","FORM","INPUT","BUTTON","TEXTAREA","SELECT","OPTION","LABEL","IFRAME","UL","OL","LI","DD","DT","A","OBJECT","PARAM","EMBED","NOSCRIPT","EM","B","STRONG","I","INS","BR","HR","PRE","H1","H2","H3","H4","H5","CITE"],getMainArticle:function(){return null},_getAllArticle:function(){for(var e=this.contentDocument.getElementsByTagName("*"),t=[],i=0,a=e.length>100?100:e.length;a>i;i++){var s=e[i];this._checkTagName(s)&&this._checkSize(s)&&this._checkVisibility(s)&&(t[t.length]=new n(s))}return t},_checkTagName:function(t){return-1==e.indexOf(this.IGNORE_TAGS,t.tagName)},_checkVisibility:function(t){return!("hidden"==e.css(t,"visibility")||"none"==e.css(t,"display")||parseInt(e.css(t,"height"))<=0||parseInt(e.css(t,"width"))<=0)},_checkSize:function(e){return e.offsetWidth>300&&e.offsetHeight>200}};var n=function(e){this.elem=e,this._texts=this._getAllTexts(),this.weight=this.calcWeight()};n.prototype={IGNORE_TAGS:["A","DD","DT","OL","OPTION","PRE","SCRIPT","STYLE","UL","IFRAME"],MINOR_REGEXP:/comment|combx|disqus|foot|header|menu|rss|shoutbox|sidebar|sponsor/i,MAJOR_REGEXP:/article|entry|post|body|column|main|content/i,TINY_REGEXP:/comment/i,BLANK_REGEXP:/\S/i,_getAllTexts:function(){for(var t=[],n=e.getTextNodes(this.elem),i=0,a=n.length;a>i;i++){var s=n[i];if(this._checkTagName(s)&&this._checkLength(s)){var r=s.parentNode||{},o=r.parentNode||{};this._checkMinorContent(r)||this._checkMinorContent(o)||t.push(s)}}return t},calcStructWeight:function(){for(var e=0,t=0,n=this._texts.length;n>t;t++){var i=this._texts[t],a=i.nodeValue.length,s=1;if(!(a>20)){for(var r=i.parentNode;r&&r!=this.elem;r=r.parentNode)s-=.1;e+=Math.pow(a*s,1.25)}}return e},calcContentWeight:function(){for(var e=1,t=this.elem;t;t=t.parentNode){var n=t.id+" "+t.className;this.MAJOR_REGEXP.test(n)&&(e+=.4),this.MINOR_REGEXP.test(n)&&(e-=.8)}return e},calcWeight:function(){return this.calcStructWeight()*this.calcContentWeight()},_checkTagName:function(t){return-1==e.indexOf(this.IGNORE_TAGS,t.tagName)},_checkLength:function(e){return Boolean(this.BLANK_REGEXP.test(e.nodeValue))},_checkMinorContent:function(e){return Boolean(this.TINY_REGEXP.test(e.id+" "+e.className))}},e.Page=t}(J),function(e){var t={runCount:0,swipe:!0,mode:"TIPS",level:1},n={0:["TIPS",3],1:["TIPS",2],2:["TIPS",1],3:["TRANS","0"],4:["NONE","NONE"]};e.TR.UI=function(t,i){var a=this;this.initLogger(i.logURL),this.log({action:"start"}),this.guid=e.guid(),this.context=t,this.conn=e.CDA("OUTFOX_JTR_CDA",i.domain,i.connFilePath),this.update=i.update,this.updateTipMsg=i.updateTipMsg,this.updateDate=i.updateDate,this.manager=new e.NodeManager,this.barHeight=50,this.permissionDenied="由于该网页存在安全性限制, 无法加载有道网页翻译2.0",this.translator=new e.TR(t,{reqSize:i.reqSize,onStatusChange:function(){a._trStatusChangeCallback.apply(a,arguments)},url:{textTrans:i.transURL,tips:i.tipsURL},guid:this.guid},this.conn,this.manager),this.queue={TRANS:{0:{currentThread:-1}},TIPS:{1:{currentThread:-1},2:{currentThread:-1},3:{currentThread:-1}},NONE:{NONE:{}}},this.mode=null,this.level=null,this.initFrame(i.cssURL,function(){var t="",i=this;location&&(t=location.href),this.movePage(i.barHeight),this.frame.body.innerHTML='                <div id="wrapper">                    <a href="http://fanyi.youdao.com/web2/?keyfrom=headerLogo" target="_blank">                        <h1 id="headerLogo" class="logo"></h1>                    </a>                    <div id="sliderLabel">翻译级别</div>                    <div id="sliderWrapper" class="slider-wrapper">                        <div id="levelLabel">                            <label id="level-3" rel="0"><a>专&nbsp;&nbsp;&nbsp;家</a></label>                            <label id="level-2" rel="1"><a>进&nbsp;&nbsp;&nbsp;阶</a></label>                            <label id="level-1" rel="2"><a>入&nbsp;&nbsp;&nbsp;门</a></label>                            <label id="level-0" rel="3"><a>全文翻译</a></label>                        </div>                        <div id="sliderContainer" class="slider-container">                            <div id="sliderBackground"><div class="slider-background"></div></div>                            <a id="slider" href="javascript:void(0);" class="slider"></a>                        </div>                    </div>                    <div id="status"></div>                    <div id="feedback">                        <a href="http://feedback.youdao.com/quality_report.jsp?q=jtr&prodtype=fanyi&cmt='+encodeURIComponent("我在网站 "+t+" 使用有道网页翻译2.0时，遇到了以下问题：")+'" target="_blank">意见与反馈</a>                        &nbsp;<a id="fb" href="http://survey2.163.com/html/fanyiweb2s201103/paper.html" target="_blank">参加问卷调查</a>                    </div>                    <div id="switchWrapper"><a id="switch" href="javascript:void(0);"></a></div>                </div>                <a id="OUTFOX_JTR_BAR_CLOSE" href="javascript:void(0);" class="OUTFOX_JTR_BAR_CLOSE"></a>                <div id="OUTFOX_JTR_BAR_UPDATE_SHADE"></div>                <div id="OUTFOX_JTR_BAR_CLOSE_UPDATE_TIP">                    <div id="OUTFOX_JTR_BAR_CLOSE_UPDATE_TIP_CONTENT"></div>                </div>',this.initTipContent(),this.initBarClose(),this.initSwitch(),this.initSlider(),this.initLabel(),this.initTipsCtrl(),this.initTransTip(),this.initSwipe();var a=function(t){i.loadSetting(t),i.enable(),i.writeSettings({runCount:i.settings.runCount+1}),e.each(n,function(e,t){i.mode===t[0]&&i.level===t[1]&&i.slider.to(e)})};this.conn.ajax({handler:"localStorage",data:{key:"settings"},dataType:"json",callback:function(e){a(e)}})})},e.TR.UI.prototype={positionElementInViewPort:function(t){var n=t.tip,i=t.target,a=!("static"===e.css(document.body,"position")),s=e.css(document.body,"marginLeft"),r=e.css(document.body,"marginRight");if("auto"===s&&"auto"===r){var o=e.getPageSize().page.width,l=parseInt(e.css(document.body,"width"));s=o>l?(o-l)/2:0}s=a?parseInt(s):0;var d=a?parseInt(e.css(document.body,"marginTop")):0,c=e.findPos(i),u=0,h=0,p=e.scroll().top,f=e.scroll().left,m=c.x,g=c.y,v=i.offsetHeight,T=n.clientHeight,y=n.clientWidth,b=(e.getPageSize().window.height,e.getPageSize().window.width);u=g-T>=p+this.barHeight?g-T:g+v,h=b+f>=m+y?m:b+f-y,e.css(t.tip,{position:"absolute",top:u-d+"px",left:h-s+"px"})},disable:function(){this.changeMode("NONE","NONE"),this.slider.disable(),this.frame.body.className="disable",this.disabled=!0,this.updateStatus(),this.switchElem.innerHTML="重新翻译"},enable:function(){this.changeMode(this.settings.mode,this.settings.level),this.slider.enable(),e.removeClass(this.frame.body,"disable"),e.addClass(this.frame.body,"enable"),this.disabled=!1,this.updateStatus(),this.switchElem.innerHTML="取消翻译"},_trStatusChangeCallback:function(e){if(e.id&&e.action&&e.level){var t=this.queue[e.action][e.level];t.currentThread<=e.id&&(t.currentThread=e.id,t.status=e.status,t.data=e.data||null,e.action===this.mode&&e.level===this.level&&this.updateStatus())}},updateStatus:function(){var t=this.queue[this.mode][this.level];if(e.removeClass(this.statusElem.parentNode,"statistic"),"busy"===t.status&&t.data){this.switchElem.style.visibility="hidden";var n=parseInt(100*t.data[0]/t.data[1],10);"TRANS"===this.mode?this.statusElem.innerHTML="正在翻译&nbsp;"+n+"%&nbsp;...":this.statusElem.innerHTML="正在分析&nbsp;"+n+"%&nbsp;...",this.statusElem.className="busy"}else if("finish"===t.status){if(this.switchElem.style.visibility="inherit","TRANS"===this.mode)this.statusElem.innerHTML="翻译完成";else{var i=this.manager.countTips(this.level);0!==i?(e.addClass(this.statusElem.parentNode,"statistic"),this.statusElem.innerHTML='共注释<span class="OUTFOX_BAR_TOTAL_NUM">'+i+"</span>个难词"):this.statusElem.innerHTML="恭喜您！该网页上没有难词~"}this.statusElem.className="finish"}else this.switchElem.style.visibility="inherit",this.statusElem.innerHTML="翻译助手已关闭",this.statusElem.className="finish"},initLogger:function(e){this.logURL=e,this._logImgCache=[]},log:function(t){if(this.logURL){t.relatedURL=document.location.href,t.guid=this.guid;var n=new Image;n.src=this.logURL+"?"+e.param(t)+"&"+(new Date).getTime(),this._logImgCache[this._logImgCache.length]=n}},initSwipe:function(){var t=this;this.swipe=e.Swipe(this.context,this.conn),this.swipe.onSwipeCallback=function(e){t.log({action:"swipeWord",word:e})}},movePage:function(t){if(e.browser.msie){var n=e.css(this.context,"paddingTop");try{n=parseInt(n)}catch(i){n=0}this.context.style.cssText+=";padding-top:"+(t+n)+"px !important;"}else{var a=e.css(this.context,"marginTop");try{a=parseInt(a)}catch(i){a=0}"static"===e.css(this.context,"position")&&e.css(this.context,{position:"relative"}),this.context.style.cssText+=";margin-top:"+(t+a)+"px !important;"}},initFrame:function(t,n){function i(t){t.innerHTML='<iframe id="OUTFOX_JTR_BAR" src="" style="display:none;"></iframe>';var n=e.query("#OUTFOX_JTR_BAR");return n.setAttribute("frameBorder",0),e.browser.msie&&document.domain!=window.location.hostname&&(n.src="javascript:void(document.write(\"<script>document.domain='"+document.domain+"';</script><body></body>\"))"),!e.browser.msie||"8.0"===e.browser.msie&&"CSS1Compat"===document.compatMode||(e.css(n,{width:e.getPageSize().window.width+"px"}),e.bind(window,"resize",function(t){e.css(n,{width:e.getPageSize().window.width+"px"})})),n}var a=this,s=document.createElement("div");s.id="OUTFOX_BAR_WRAPPER",this.context.appendChild(s),this.wrapper=s;var r=i(s);this.iframe=r,setTimeout(function(){try{a.frame=r.contentDocument||r.contentWindow.document}catch(i){return a.log({action:"secRestrict",relatedURL:window.location.href}),void alert(a.permissionDenied)}e.css(r,{display:"block"}),e.addClass(r,"OUTFOX_JTR_BAR"),e.loadCSS(a.frame,t),a.frame.body.id="OUTFOX_JTR_BAR_BODY",e.addClass(a.frame.body,"forbid-select"),a.frame.body.onselectstart=a.frame.body.ondrag=function(){return!1},n.call(a)},100)},initBarClose:function(){var t=this,n=this.frame.getElementById("OUTFOX_JTR_BAR_CLOSE");e.addClass(n,"OUTFOX_JTR_BAR_CLOSE"),e.bind(window,"resize",function(t){e.css(n,{top:"1px",right:"1px"})}),e.bind(n,"click",function(){t.disable(),t.movePage(-t.barHeight),t.context.removeChild(t.wrapper),t.context.removeChild(e.query("#OUTFOX_JTR_CDA")),t.context.removeChild(e.query("#yddWrapper")),t.context.removeChild(e.query("#outfox_seed_js"))})},initTipContent:function(){if(this.update){var t=this,n=function(){var n=e.query("#OUTFOX_JTR_BAR_CLOSE_UPDATE_TIP_CONTENT",t.frame),i=e.query("#OUTFOX_JTR_BAR_UPDATE_SHADE",t.frame),a=e.query("#OUTFOX_JTR_BAR_CLOSE_UPDATE_TIP",t.frame);n.innerHTML="更新提示：<br/>"+t.updateTipMsg+'<span class="update-date">'+t.updateDate+'</span><a href="javascript:void(0);" id="OUTFOX_JTR_BAR_CLOSE_UPDATE_TIP_CONTENT_CLOSE"></a>';var s=e.query("#OUTFOX_JTR_BAR_CLOSE_UPDATE_TIP_CONTENT_CLOSE",t.frame);e.css(i,{display:"block"}),e.css(a,{display:"block"}),e.bind(s,"click",function(){e.css(i,{display:"none"}),e.css(a,{display:"none"})})};t.conn.ajax({handler:"localStorage",data:{key:"date"},callback:function(e){e!==t.updateDate&&(n(),t.conn.ajax({handler:"localStorage",data:{key:"date",value:t.updateDate}}))}})}},initSwitch:function(){var t=this;this.statusElem=e.query("#status",this.frame),this.switchElem=e.query("#switch",this.frame),e.bind(this.switchElem,"click",function(e){t.disabled?t.enable():t.disable()})},initLabel:function(){this.labels=[];for(var t=this,i=function(i){var a=i||window.event,s=a.target||a.srcElement,r=s.parentNode.getAttribute("rel");t.disabled||r&&(t.changeMode(n[r][0],n[r][1]),e.each(n,function(e,n){t.mode===n[0]&&t.level===n[1]&&t.slider.to(e)}))},a=0;4>a;a++)this.labels[a]=e.query("#level-"+a,this.frame),e.bind(this.labels[a],"click",i)},initSlider:function(){var t=e.query("#sliderContainer",this.frame),n=e.query("#slider",this.frame),i=this,a=null,s=10;this.slider=new e.Slider(t,n,{bar:e.query("#sliderBackground",this.frame),max:3,min:0,step:1,borderFix:-3,callback:function(e){clearTimeout(a),a=setTimeout(function(){i._valueChange(e)},s)}})},loadSetting:function(n){var i={};if(null===n||"[object Object]"!==Object.prototype.toString.call(n))this.conn.ajax({handler:"localStorage",dataType:"json",data:{key:"settings",value:JSONDAO.stringify(t)}}),i=t;else for(var a in t)t.hasOwnProperty(a)&&(i[a]=n.hasOwnProperty(a)?n[a]:t[a]);i.mode=i.mode||t.mode,i.level=i.level||t.level,e.log("Load Settings:",i),this.settings=i},_valueChange:function(e){var t=Math.round(e),i=n[t][0],a=n[t][1];i!==this.mode?this.changeMode(i,a):a!==this.level&&this.changeLevel(a)},changeMode:function(e,t){if("TIPS"===this.mode){for(var n=1;3>=n;n++)this.labels[n].className="deactive";this.translator.revertTips()}else"TRANS"===this.mode&&(this.labels[0].className="deactive",this.translator.revertTrans());this.swipe.disableSwipe(),this.disableTransTip(),this.disableTipsCtrl(),this.mode=e,this.changeLevel(t)},changeLevel:function(t){if(e.log("Change level to:",t),null===this.level?this.log({action:"view",level:t}):this.log({action:"changeLevel",oldLevel:this.level,newLevel:t}),this.level=t,"TIPS"===this.mode){this.swipe.enableSwipe();for(var n=1;3>=n;n++)this.labels[n].className=n==t?"active":"deactive";this.translator.revertTips(),this.translator.doTips(this.level),this.enableTipsCtrl()}else"TRANS"===this.mode&&(this.labels[0].className="active",this.translator.doTrans(),this.enableTransTip());"NONE"!==this.mode&&this.writeSettings({mode:this.mode,level:this.level})},writeSettings:function(t){e.each(t,function(e,t){this.settings[e]=t},this),this.conn.ajax({handler:"localStorage",dataType:"json",data:{key:"settings",value:JSONDAO.stringify(this.settings)}})},initTipsCtrl:function(){var t=this,n=this.initTipsCtrlElem(),i=null;this.tipsTarget=null,this.tipsCtrlHandler=function(a){var s=a||window.evt,r=s.target||s.srcElement;clearTimeout(i),r===t.tipsTarget||r.className&&-1!==r.className.indexOf("OUTFOX_JTR_NANCI_")||(i=setTimeout(function(){if(n.parentNode&&n.parentNode.removeChild(n),e.hasClass(r,"OUTFOX_NANCI_TIPS")){var i=e.findPos(r),a=e.query(".OUTFOX_JTR_NANCI_CTRL_WORD",n)[0];t.context.appendChild(n),a.innerHTML=r.innerHTML;var s=e.css(r,"fontSize"),o=e.css(r,"fontFamily");try{-1!=s.indexOf("em")||parseInt(s)<12&&(s="12px")}catch(l){s="12px"}var d=!("static"===e.css(document.body,"position")),c=e.css(document.body,"marginLeft"),u=e.css(document.body,"marginRight");if("auto"===c&&"auto"===u){var h=e.getPageSize().page.width,p=parseInt(e.css(document.body,"width"));c=h>p?(h-p)/2:0}c=d?parseInt(c):0;var f=d?parseInt(e.css(document.body,"marginTop")):0;e.css(a,{fontSize:s}),e.css(a,{fontFamily:o}),e.css(n,{left:i.x-c+"px",top:i.y-f+"px",position:"absolute"}),t.tipsTarget=r}else t.tipsTarget=null},200))}},initTipsCtrlElem:function(){var t=document.createElement("span"),n=document.createElement("span"),i=document.createElement("a"),a=document.createElement("span"),s=document.createElement("a"),r=document.createElement("span"),o=this;r.className="OUTFOX_JTR_NANCI_CTRL_WORD",t.appendChild(r),i.className="OUTFOX_JTR_NANCI_CTRL_DETAIL",i.setAttribute("title","查看详细解释"),i.innerHTML="详解",n.appendChild(i),n.className="OUTFOX_JTR_NANCI_CTRL_DETAIL_BG",t.appendChild(n),s.className="OUTFOX_JTR_NANCI_CTRL_CLOSE",s.setAttribute("title","我知道了"),s.innerHTML="关闭",a.appendChild(s),a.className="OUTFOX_JTR_NANCI_CTRL_CLOSE_BG",t.appendChild(a),t.className="OUTFOX_JTR_NANCI_BAR";var l=function(){var e=null;try{e=o.tipsTarget.previousSibling}catch(t){}return e},d=function(e){var t=null;if(document.createRange){var n=window.getSelection();t=document.createRange(),n.removeAllRanges(),t.selectNode(e),n.addRange(t)}else document.body.createTextRange&&(t=document.body.createTextRange(),t.moveToElementText(e),t.select())};return e.bind(i,"click",function(n){var i=l();if(i&&o.swipe){o.log({action:"viewDetail",word:i.innerHTML}),d(i);var a=document.createElement("font");a.innerHTML="&nbsp",i.appendChild(a);var s=e.findPos(a),r=a.offsetHeight;i.removeChild(a),o.swipe.swipeWord(i.firstChild.nodeValue,s.x,s.y,0,r)}t.parentNode.removeChild(t),e.removeClass(o.tipsTarget,"on")}),e.bind(s,"click",function(n){var i=(t.getAttribute("rel"),l());i&&(o.log({action:"closeTip",word:i.innerHTML,tip:o.tipsTarget.innerHTML}),o.translator._manager.revertTip(i)),t.parentNode.removeChild(t),e.removeClass(o.tipsTarget,"on")}),t},_findTipCtrlPosition:function(t,n){var i=t.firstChild,a=i.nodeValue,s=i.nodeValue.length,r=document.createElement("font"),o=document.createTextNode(""),l=[0,0],d=null,c=null,u=null,h=0,p=0,f=0,m=s,g=null;e.css(r,{border:"none",padding:0,margin:0});for(var v=0;s>=v;v++)o.nodeValue=i.nodeValue.substr(v),i.nodeValue=i.nodeValue.substr(0,v),t.insertBefore(o,i.nextSibling),t.insertBefore(r,i.nextSibling),u=e.findPos(r),h=u.x-n[0],p=u.y-n[1],0>=p&&(null===c||p>c)&&(g=c=p,l[0]=u.x,l[1]=u.y,d=null,f=v),p!==g&&(m=v,g=p),i.nodeValue=a,t.removeChild(o),t.removeChild(r);return r.innerHTML=i.nodeValue.substr(f,m),i.nodeValue=i.nodeValue.substr(0,f),t.insertBefore(r,i.nextSibling),l[0]+=r.offsetWidth,t.removeChild(r),i.nodeValue=a,l},preventClose:function(){e.css(e.query("#OUTFOX_JTR_BAR_CLOSE",this.frame),{display:"none"})},enableTipsCtrl:function(){e.bind(this.context,"mouseover",this.tipsCtrlHandler)},disableTipsCtrl:function(){e.unbind(this.context,"mouseover",this.tipsCtrlHandler)},enableTransTip:function(){e.bind(this.context,"mouseover",this.transTipHandler)},disableTransTip:function(){e.unbind(this.context,"mouseover",this.transTipHandler)},initTransTip:function(t){var n=this,i=null,a=null;this.initTransTipElem("",""),this.transTipHandler=function(t){var s=t||window.event,r=s.target||s.srcElement;clearTimeout(a),a=setTimeout(function(){if(i!==r&&(!r.className||-1===r.className.indexOf("OUTFOX_JTR_TRANSTIP_")&&-1===r.className.indexOf("ydd-")))if(i&&(i.style.textDecoration="none"),n.transTipElem.elem.parentNode&&n.transTipElem.elem.parentNode.removeChild(n.transTipElem.elem),e.hasClass(r,"OUTFOX_JTR_TRANS_NODE")){i=r;var t=r.getAttribute("rel"),a=n.translator._manager;n.resetTransTipElem(a.originals[t],a.transResults[t],t),n.context.appendChild(n.transTipElem.elem),n.positionElementInViewPort({target:r,tip:n.transTipElem.elem}),r.style.textDecoration="underline"}else i=null},200)}},initTransTipElem:function(){var t=this,n=document.createElement("div");n.className="OUTFOX_JTR_TRANSTIP_WRAPPER";var i=document.createTextNode(""),a=document.createTextNode("");n.innerHTML+='<div class="OUTFOX_JTR_TRANSTIP_ORIGIN">                                        <div class="ydd-container">                                          <div class="ydd-top-wrapper">                                            <div class="ydd-top">                                            </div>                                          </div>                                          <div class="ydd-body-wrapper">                                            <div class="ydd-lb"></div>                                            <div class="ydd-rb"></div>                                            <div class="ydd-body">                                              <div class="ydd-title">                                                <strong>原文：</strong>                                              </div>                                              <div class="ydd-middle">                                                <div class="OUTFOX_JTR_TRANSTIP_ORIGIN_TEXT"></div>                                                <div class="OUTFOX_JTR_TRANSTIP_ADVISE">                                                  <textarea class="OUTFOX_JTR_TRANSTIP_ADVISE_TEXT"></textarea>                                                  <a class="OUTFOX_JTR_TRANSTIP_ADVISE_SUBMIT" href="javascript:void(0);">提交翻译建议</a>                                                </div>                                              </div>                                            </div>                                          </div>                                          <div class="ydd-bottom-wrapper">                                            <div class="ydd-bottom">                                              <a class="OUTFOX_JTR_TRANSTIP_ADVISE_TOGGLE">更好的翻译建议</a>                                              <span class="OUTFOX_JTR_TRANSTIP_ADVISE_THANK">感谢您为有道提供建议^_^</span>                                            </div>                                          </div>                                          <div class="ydd-bg-top"></div>                                        </div>                                      </div>',e.query(".OUTFOX_JTR_TRANSTIP_ORIGIN_TEXT",n)[0].appendChild(a),e.query(".OUTFOX_JTR_TRANSTIP_ADVISE_TEXT",n)[0].appendChild(i);var s=e.query(".OUTFOX_JTR_TRANSTIP_ADVISE_TOGGLE",n)[0],r=e.query(".OUTFOX_JTR_TRANSTIP_ADVISE_SUBMIT",n)[0],o=e.query(".OUTFOX_JTR_TRANSTIP_ADVISE",n)[0],l=e.query(".ydd-bottom",n)[0],d=e.query(".OUTFOX_JTR_TRANSTIP_ADVISE_TEXT",n)[0];r.hideFocus=!0,e.bind(s,"click",function(){e.toggleClass(o,"expand"),e.css(s,{display:"none"})});var c=function(e){return e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;")};e.bind(r,"click",function(){var n=d.value;if(""===n)return void alert("翻译建议不能为空，请您输入内容后再次提交");n=c(n),e.addClass(o,"finish"),e.removeClass(o,"expand"),e.addClass(l,"OUTFOX_JTR_TRANSTIP_ADVISE_THANK_TIP");var i=t.transTipElem.index;i&&t.manager.transResults[i]&&(t.manager.transResults[i]=n,t.manager.revertTrans(i),t.manager.replaceTrans(i))}),this.transTipElem={elem:n,transTextContainer:d,trans:i,original:a,toggle:s,submit:r,advise:o,bottom:l,index:null}},resetTransTipElem:function(t,n,i){e.removeClass(this.transTipElem.advise,"finish"),e.removeClass(this.transTipElem.advise,"expand"),e.removeClass(this.transTipElem.bottom,"OUTFOX_JTR_TRANSTIP_ADVISE_THANK_TIP"),this.transTipElem.toggle.innerHTML="提交翻译建议",e.css(this.transTipElem.toggle,{display:""}),this.transTipElem.transTextContainer.value=n,this.transTipElem.original.nodeValue=t,this.transTipElem.index=i}}}(J),function(e){var t="http://fanyi.youdao.com/web2",n="http://fanyi.youdao.com",i="/web2/conn.html",a=t+"/index.do",s=n+"/jtr",r=t+"/rl.do",o=t+"/styles/all-packed.css";e.loadCSS(document,o),window.OUTFOX_JavascriptTranslatoR=new e.TR.UI(document.body,{domain:n,update:!1,updateTipMsg:"修复链接错误",updateDate:"2013-12-24",cssURL:o,tipsURL:a,transURL:s,logURL:r,connFilePath:i,reqSize:20})}(J)}}();